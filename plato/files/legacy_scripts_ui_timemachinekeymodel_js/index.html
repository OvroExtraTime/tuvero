<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Plato - legacy/scripts/ui/timemachinekeymodel.js</title>

  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="">
  <meta name="author" content="">

  <!--[if lt IE 9]>
  <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
  <![endif]-->

  <link href="../../assets/css/vendor/morris.css" rel="stylesheet">
  <link href="../../assets/css/vendor/bootstrap.css" rel="stylesheet">
  <link href="../../assets/css/vendor/font-awesome.css" rel="stylesheet">
  <link href="../../assets/css/vendor/codemirror.css" rel="stylesheet">
  <link href="../../assets/css/plato.css" rel="stylesheet">
  <link href="../../assets/css/plato-file.css" rel="stylesheet">

</head>

<body>

<div class="navbar navbar-fixed-top">
  <div class="container">
    <a class="navbar-brand" href="http://github.com/es-analysis/plato">Plato on Github</a>
    <ul class="nav navbar-nav">
      <li>
        <a href="../../index.html">Report Home</a>
      </li>
    </ul>
  </div>
</div>

<div class="jumbotron">
  <div class="container">
    <h1>legacy/scripts/ui/timemachinekeymodel.js</h1>
  </div>
</div>

<div class="container aggregate-stats">
  <div class="row">
    <div class="col-md-6">
      <h2 class="header">Maintainability <a href="http://blogs.msdn.com/b/codeanalysis/archive/2007/11/20/maintainability-index-range-and-meaning.aspx"><i class="icon icon-info-sign" rel="popover" data-placement="top" data-trigger="hover" data-content="A value between 0 and 100 that represents the relative ease of maintaining the code. A high value means better maintainability." data-original-title="Maintainability Index"  data-container="body"></i></a></h2>
      <p class="stat">64.26</p>
    </div>
    <div class="col-md-6">
      <h2 class="header">Lines of code <i class="icon icon-info-sign" rel="popover" data-placement="top" data-trigger="hover" data-content="Source Lines of Code / Logical Lines of Code" data-original-title="SLOC/LSLOC" data-container="body"></i></h2>
      <p class="stat">180</p>
    </div>
  </div>
  <div class="row historical">
    <div class="col-md-6">
      <p id="chart_historical_maint" class="chart"></p>
    </div>
    <div class="col-md-6">
      <p id="chart_historical_sloc" class="chart"></p>
    </div>
  </div>
  <div class="row">
    <div class="col-md-6">
      <h2 class="header">Difficulty  <a href="http://en.wikipedia.org/wiki/Halstead_complexity_measures"><i class="icon icon-info-sign" rel="popover" data-placement="top" data-trigger="hover" data-content="The difficulty measure is related to the difficulty of the program to write or understand." data-original-title="Difficulty" data-container="body"></i></a></h2>
      <p class="stat">33.21</p>
    </div>
    <div class="col-md-6">
      <h2 class="header">Estimated Errors  <a href="http://en.wikipedia.org/wiki/Halstead_complexity_measures"><i class="icon icon-info-sign" rel="popover" data-placement="top" data-trigger="hover" data-content="Halstead's delivered bugs is an estimate for the number of errors in the implementation." data-original-title="Delivered Bugs" data-container="body"></i></a></h2>
      <p class="stat">1.07</p>
    </div>
  </div>
</div>

<div class="container charts">
  <div class="row">
    <h2 class="header">Function weight</h2>
  </div>
  <div class="row">
    <div class="col-md-6">
      <h3 class="chart-header">By Complexity <a href="http://en.wikipedia.org/wiki/Cyclomatic_complexity"><i class="icon icon-info-sign" rel="popover" data-placement="top" data-trigger="hover" data-content="This metric counts the number of distinct paths through a block of code. Lower values are better." data-original-title="Cyclomatic Complexity" data-container="body"></i></a></h3>
      <div id="fn-by-complexity" class="stat"></div>
    </div>
    <div class="col-md-6">
      <h3 class="chart-header">By SLOC  <i class="icon icon-info-sign" rel="popover" data-placement="top" data-trigger="hover" data-content="Source Lines of Code / Logical Lines of Code" data-original-title="SLOC/LSLOC" data-container="body"></i></h3>
      <div id="fn-by-sloc" class="stat"></div>
    </div>
  </div>
</div>

<div class="container">
  <div class="row">
    <textarea id="file-source" class="col-md-12">/**
 * TimeMachineKeyModel *
 *
 * @return TimeMachineKeyModel
 * @author Erik E. Lorenz &lt;erik.e.lorenz@gmail.com&gt;
 * @license MIT License
 * @see LICENSE
 */
define([&#039;lib/extend&#039;, &#039;core/model&#039;, &#039;core/type&#039;, &#039;presets&#039;], function(extend,
    Model, Type, Presets) {
  var delimiter, dateRegexSource, dateRegex, keyRegex, tuveroKeyRegex;

  delimiter = &#039;_&#039;;
  dateRegexSource = &#039;[0-9]{4}-[0-9]{2}-[0-9]{2}&#039;
      + &#039;T[0-9]{2}:[0-9]{2}:[0-9]{2}\.[0-9]{3}Z&#039;;
  dateRegex = new RegExp(&#039;^&#039; + dateRegexSource + &#039;$&#039;);
  targetRegex = new RegExp(&#039;^(&#039; + Presets.target + &#039;)&#039; + delimiter);
  keyRegex = new RegExp(targetRegex.source + &#039;(&#039; + dateRegexSource + &#039;)&#039;
      + delimiter + &#039;(&#039; + dateRegexSource + &#039;)$&#039;);
  tuveroKeyRegex = new RegExp(&#039;^([a-z]*)&#039; + delimiter + &#039;(&#039; + dateRegexSource
      + &#039;)&#039; + delimiter + &#039;(&#039; + dateRegexSource + &#039;)$&#039;);

  /**
   * Constructor. Either a root key (empty construction), a descendant of
   * another key (pass a TimeMachineKeyModel instance as parent) or a
   * representation (pass a key string to read all info from) *
   *
   * @param reference
   *          Leave empty to create a new key. TimeMachineKeyModel instance to
   *          create a child from, or a key string to create a representation
   *          from.
   */
  function TimeMachineKeyModel(reference) {
    var matches;
    TimeMachineKeyModel.superconstructor.call(this);

    this.saveDate = (new Date()).toISOString();
    this.startDate = this.saveDate;
    this.target = Presets.target;

    if (!dateRegex.test(this.saveDate)) {
      throw new Error(&#039;Date.toISOString() does not return valid ISO 8601.&#039;);
    }

    if (Type.isString(reference)) {
      if (!targetRegex.test(reference)) {
        throw new Error(
            &#039;TimeMachineKeyModel reference string has wrong target: &#039;
                + reference);
      }
      matches = keyRegex.exec(reference);
      if (!matches) {
        throw new Error(
            &#039;TimeMachineKeyModel reference string does not match format&#039;);
      }
      if (matches.length != 4) {
        throw new Error(&#039;Regex Error? wrong number of captures (not 3): &#039;
            + matches.join(&#039;,&#039;));
      }

      // this.target has already been set from Presets.
      this.startDate = matches[2];
      this.saveDate = matches[3];
    } else if (Type.isObject(reference)
        &amp;&amp; reference instanceof TimeMachineKeyModel) {
      if (!dateRegex.test(reference.startDate)) {
        throw new Error(
            &#039;referenced TimeMachineKeyModel startDate is no valid ISO 8601&#039;);
      }
      this.startDate = reference.startDate;
    } else if (reference !== undefined) {
      throw new Error(&#039;TimeMachineKeyModel(): invalid argument: &#039; + reference);
    }
  }
  extend(TimeMachineKeyModel, Model);

  // TODO test!
  TimeMachineKeyModel.construct = function(startDate, saveDate) {
    var str = [Presets.target, startDate, saveDate].join(delimiter);

    return new TimeMachineKeyModel(str);
  };

  /**
   * converts the the Key to a localStorage-compatible string representation *
   *
   * @return a localStorage-compatible string representation of the key
   */
  TimeMachineKeyModel.prototype.toString = function() {
    var key = [this.target, this.startDate, this.saveDate].join(delimiter);

    if (!keyRegex.test(key)) {
      throw new Error(&#039;created TimeMachineKeyModel does not match format: &#039;
          + key);
    }

    return key;
  };

  /**
   * Test whether the given key is valid and can be processed by this target.
   * This does not test the stored content, only the key strings.
   *
   * @param key
   *          a string representation of a key
   * @return true if key matches the key format and currently open target, false
   *         otherwise
   */
  TimeMachineKeyModel.isValidKey = function(key) {
    if (Type.isObject(key)) {
      key = key.toString();
    }

    return keyRegex.test(key);
  };

  /**
   * Test whether the given key could in theory be used for another target
   * (Basic, Boule, TAC, ...)
   *
   * @param key
   *          a string representation of a key
   * @return true if key matches the tuvero key format, regardless of the target
   */
  TimeMachineKeyModel.isTuveroKey = function(key) {
    if (Type.isObject(key)) {
      key = key.toString();
    }

    return tuveroKeyRegex.test(key);
  };

  /**
   * Test whether a key is valid and an init key, i.e. both dates match
   *
   * @param key
   *          a key
   * @return true if valid and an init key, false otherwise
   */
  TimeMachineKeyModel.isInitKey = function(key) {
    if (!TimeMachineKeyModel.isValidKey(key)) {
      return false;
    }

    if (Type.isString(key)) {
      key = new TimeMachineKeyModel(key);
    }

    return key instanceof TimeMachineKeyModel &amp;&amp; key.startDate
        &amp;&amp; key.startDate == key.saveDate;
  };

  /**
   * Test whether the key is somehow related to this key, i.e. whether the start
   * date and target match. This does not test whether they&#039;re in the same
   * branch, since only the keys are tested, not their relations.
   *
   * If used as an Array.filter() function, you must use the bind() function!
   *
   * @param key
   * @return true if target and start date match, false otherwise.
   */
  TimeMachineKeyModel.prototype.isRelated = function(key) {
    if (Type.isObject(key)) {
      key = key.toString();
    }

    var relatedRegex = new RegExp(targetRegex.source + &#039;(&#039; + this.startDate
        + &#039;)&#039; + delimiter + &#039;(&#039; + dateRegexSource + &#039;)$&#039;, &#039;i&#039;);

    return relatedRegex.test(key);
  };

  /**
   * @param key
   *          a key string or instance
   * @return true if both keys match, false otherwise
   */
  TimeMachineKeyModel.prototype.isEqual = function(key) {
    if (Type.isObject(key)) {
      key = key.toString();
    }

    return this.toString() == key.toString();
  };

  return TimeMachineKeyModel;
});</textarea>
  </div>
</div>

<footer class="footer">
  <div class="container">
    <p>.</p>
  </div>
</footer>

<script type="text/html" id="complexity-popover-template">
  <div class="complexity-notice">
    Complexity : {{ complexity.cyclomatic }} <br>
    Length : {{ complexity.halstead.length }} <br>
    Difficulty : {{ complexity.halstead.difficulty.toFixed(2) }} <br>
    Est # bugs : {{ complexity.halstead.bugs.toFixed(2) }}<br>
  </div>
</script>

<script type="text/javascript" src="../../assets/scripts/bundles/core-bundle.js"></script>
<script type="text/javascript" src="../../assets/scripts/bundles/codemirror.js"></script>
<script type="text/javascript" src="../../assets/scripts/codemirror.markpopovertext.js"></script>
<script type="text/javascript" src="report.js"></script>
<script type="text/javascript" src="report.history.js"></script>
<script type="text/javascript" src="../../assets/scripts/plato-file.js"></script>
</body>
</html>
